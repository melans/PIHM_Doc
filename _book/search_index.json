[
["intro.html", "Penn State Integrated Hydrologic Model(PIHM) Theoretical Documentation Chapter 1 Introduction 1.1 Why PIHM? 1.2 History of PIHM system 1.3 Steps 1.4 Research with PIHM family 1.5 Latest update 1.6 Governing equations", " Penn State Integrated Hydrologic Model(PIHM) Theoretical Documentation Lele Shu (lele.shu@gmail.com) 2019-05-02 Chapter 1 Introduction PIHM The Penn State Integrated Hydrologic Model (PIHM) is a multiprocess, multi-scale hydrologic model where the major hydrological processes are fully coupled using the semi-discrete Finite Volume Method. PIHMGIS The model itself is “tightly-coupled” with PIHMgis, an open-source Geographical Information System designed for PIHM. The PIHMgis provides the access to the digital data sets (terrain, forcing and parameters) and tools necessary to drive the model, as well as a collection of GIS-based pre- and post-processing tools. Collectively the system is referred to as the Penn State Integrated Hydrologic Modeling System (PIHMS). The PIHM is an open source software, freely available for download at PIHM website or Github Page along with installation and user guides. 1.1 Why PIHM? It is our intention to begin a debate on the role of Community Models in the hydrologic sciences. Our research is a response to recent trends in US funding for Observatory Science that have emerged at NSF over the last few years, namely, the NSF-funded CUAHSI program (Consortium of Universities for Advanicing Hydrologic Sciences). PIHM represents our strategy for the synthesis of multi-state, multiscale distributed hydrologic models using the integral representation of the underlying physical process equations and state variables. Our interest is in devising a concise representation of watershed and/or river basin hydrodynamics, which allows interactions among major physical processes operating simultaneously, but with the flexibility to add or eliminate states/processes/constitutive relations depending on the objective of the numerical experiment or purpose of the scientific or operational application. To satisfy the objectives, the PIHM is distributed hydrologic model, based on the semi-discrete Finite-Volume Method (FVM) in which domain discretization is an unstructured triangular irregular network (e.g. Delaunay triangles) generated with constraints (geometric, and parametric). A local prismatic control volume is formed by vertical projection of the Delauney triangles forming each layer of the model. Given a set of constraints (e.g. river network support, watershed boundary, altitude zones, ecological regions, hydraulic properties, climate zones, etc), an “optimal” mesh is generated. River volume elements are also prismatic, with trapezoidal or rectangular cross-section, and are generated along or cross edges of Delauney triangles. The local control volume contains all equations to be solved and is referred to as the model kernel. is physically-based model, in which all equations used is descibing the physics of the hydrological processes which control the catchment. The physical model is ablr to predict the water in ungage water system, to estimate the sediment, pullutants and vegetation etc, such that it is practical to be coupled with biochemistry, geomorphology, limnology and other water-related research. The global ODE system is assembled by combining all local ODE systems throughout the domain and then solved by a state-of-the-art parallel ODE solver known as CVODE developed at the Lawrence- Livermore National Laboratory. is fully-couple hydrologic model, where the state and flux variables in the hydrologic system are solved within same time step and conserve the mass. The fluxes are infiltration, overland flow, groundwater recharge, lateral groundwater flow, exchange of river and soil/groundwater and river discharge. is adaptable temporal and spatial resolution. The spatial resolution of model varies from meters to kilometers based requirement of modeling and computing resources. Internal time step of iteration step are adjustable; it is able to export the status of catchment in less 1 sencond to days. Also the time interval for exporting results is configured flexiblly. The flexible spatial and temporal resolution is rather valueable for community model coupling. is open source model, anyone can access the source code, use and submit their improvement. is long-term yield and single-event flood model. An important partnership and motivation for this work was the Project Leaders participation in two community-science research activites over the last few years: The University of Arizona-led Science and Technology Center (SAHRA: Sustainability of Water Resources in Semi- Arid Regions), and the Chesapeake Community Modeling Project (CCMP). Each of these research programs has been essential to supporting the concept of Community Models for environmental prediction and helping to make it happen. 1.2 History of PIHM system 2005 PIHM v1.0 Dr Yizhong Qu developed and verified the first version of PIHM in 2001-2005 during his PhD in Pennsylvania State Unversity, following the blueprint of Freeze and Harlan (1969). This version of PIHM is the soul of the PIHM model. 2009 PIHMgis Dr. Gopal Bhartt developed the PIHMgis with support of C++, Qt GUI library, TRIANGLE library and QGIS developing kit. The developmemnt of PIHMgis make the learning curve of PIHM moderate and benefits the developing, modeling and coupling. 2015 MM-PIHM Dr. Yuninh Shi led and developed the MM-PIHM (Multi-Module PIHM), which embeded the all modules from PIHM family, such as RT-PIHM, LE-PIHM, flux-PIHM, BGC-PIHM etc. together. The sophysiticated design and coupling of the MM-PIHM is the summit of the PIHM as a Community Model that combined all water-related module together. 2019 PIHM++ Based on the accumulated contribution of PIHM modeling and coupling with related researches, it is neccessary to solve the known bugs and limitation, improve the performance of model with parrellel methods, and adopt new update from SUNDIALS solver and programming strategy. ## Steps of PIHM modeling 1.2.1 Essential Terrestrial Variables? Atmospheric Forcing (precipitation, snow cover, wind, relative humidity, temperature, net radiation, albedo, photosynthestic atmospheric radiation, leaf area index) Digital elevation models River/Stream Discharge Soil (class, hydrologic properties) Groundwater (levels, extent, hydro-geologic properties) Lake/Reservoir (levels, extent) Land Cover/Use (biomass, human infrastructure, demography, ecosystem disturbance) Water Use Most data reside on federal servers ….many petabytes 1.2.2 A-Priori Data Sources Feature/Time-Series Property Source Soil Porosity; Sand, Silt, Clay Fractions; Bulk Density CONUS, SSURGO and STATSGO Geology Bed Rock Depth; Horizontal and Vertical Hydraulic Conductivity http://www.dcnr.state.pa.us/topogeo/, http://www.lias.psu.edu/emsl/guides/X.html Land Cover LAI UMC, LDASmapveg; Land Cover Manning’s Roughness; Hernandez et. al., 2000 River Manning’s Roughness; Dingman (2002) River Coefficient of Discharge ModHms Manual (Panday and Huyakorn, 2004) River Shape and Dimensions; Derived from regression using depth, width and discharge data from USGS data River Topology: Nodes, Neighboring Elements; Derived using PIHMgis (Bhatt et. al., 2008) Forcing Prec, Temp. RH, Wind, Rad. National Land Data Assimilation System : NLDAS-2 Topography DEM http://seamless.usgs.gov/ Streamflow http://nwis.waterdata.usgs.gov/nwis/sw Groundwater http://nwis.waterdata.usgs.gov/nwis/gw 1.3 Steps The workflow of modeling with PIHM System Prepare raw Essential Terrestrial Variables (ETV) Build the PIHM modeling domain with PIHMgis or PIHMgisR (Recommended for PIHM++) Run PIHM on desktop or cluster. Analysis the PIHM results with PIHMgisR or your hydrologic analysis tools. 1.4 Research with PIHM family Research Ara Scientific question Reference Malpasset dam, etc. Hydrodynamic in dam break and food event (???) 1.5 Latest update PIHM++ is the latest version of PIHM, re-developed in C++, a updated version from the PIHM v2.2 that is the stable and widely applied version, and that was released on 2010. The design of PIHM++ is going to advance the PIHM to the new level: Technical improvement Support the latest implicit Sundial/CVODE solver. Re-code the program in object-oriented programming method. More human readable input/output files and filenames. Support OpenMP and OpenMPI Parrallel computing. The functions to handle the time-series data, including forcing, LAI, Roughness Length, Boundary Condition, Melt factor. Speed up the model performance via coding strategies. Screen output the model status and time-spend. Fix the bugs in PIHM v2.x. Model improvement Change the structure/shape of River. Add Lakes into the hydrologic process (keep updating). CMA-ES calibration, with either OpenMP or OpenMPI. Use the Greem-Ampt method to estimate infiltration. Add the waterbalance control in elements. Hourly update the ET and Potential ET. Model debug mode. Export model initial condition at specific interval. Automatic check the range of physical parameters 1.6 Governing equations Physical process Equation name Governing equation Semi-discrete formula from ODE Interception Bucket model \\(\\frac{d S_{ic}}{d t} = P - E_{ic}-P_{tf}\\) \\(\\left(\\frac{d S_{ic}}{d t}=R_{veg} * \\left(P-E_{I}-P_{t}\\right)\\right)_{i}\\) Snow melt Temperature Index Model \\(\\frac{d S_{sn}}{d t}=P-E_{sn}-q_{sm}\\) \\(\\left(\\frac{d S_{sn}}{d t}=P-E_{sn}-q_{sm}\\right)_{i}\\) Overland flow St. Venant Equation (2D) \\(\\frac{\\partial h}{\\partial t}+\\frac{\\partial(u h)}{\\partial x}+\\frac{\\partial(v h)}{\\partial y}=q\\) \\(\\left(\\frac{d h}{\\partial t} =P_{net}-E_{sf}-q_{inf}-q_{sf}\\right)_{i}\\) Unsaturated zone Richards Equation \\(C(\\psi) \\frac{\\partial \\psi}{\\partial t}=\\nabla-K(\\psi) \\cdot \\nabla(\\psi+Z)\\) \\(\\left(\\frac{d S_{unsat}}{d t}=q_{inf}-q_{rech}-ET_{s}\\right)_{i}\\) Groundwater flow Richards Equation$ \\(C(\\psi) \\frac{\\partial \\psi}{\\partial t}=\\nabla-K(\\psi) \\cdot \\nabla(\\psi+Z)\\) \\(\\left(S_y \\frac{d S}{d t}=q_{rech}+q_{gw}\\right)_{i}\\) River channel St. Venant Equation (1D) \\(\\frac{\\partial h}{\\partial t}+\\frac{\\partial(u h)}{\\partial x}=q\\) \\(\\left(\\frac{\\partial S}{\\partial t} = Q_{up} + Q_{surf} + Q_{sub} + Q_{down} \\right)_{i}\\) "],
["ET.html", "Chapter 2 Evapotranspiration 2.1 Hargreaves ETo equation 2.2 Penman-Monteith equation", " Chapter 2 Evapotranspiration 2.1 Hargreaves ETo equation \\[ {ET}_{{o}}=0.0023\\left({T}_{{mean}}+17.8\\right)\\left({T}_{\\max }-{T}_{\\min }\\right)^{0.5} {R}_{{a}} \\] 2.2 Penman-Monteith equation The Potential Evapotranspiration (PET) in PIHM++ uses the Penman-Monteith equation, that combined “the energy balance with the mass transfer method and derived an equation to compute the evaporation from an open water surface from standard climatological records of sunshine, temperature, humidity and wind speed” (FAO). Penman-Monteith Equation is written as: \\[ \\lambda ET = \\frac{\\Delta (R_n - G) + \\rho_a c_p \\frac{(e_s -e_a)}{r_a}} {\\Delta + \\gamma (1+\\frac{r_s}{r_a})} \\] \\[ \\Delta=\\frac{4098\\left\\{0.6108 \\exp \\left(\\frac{17.27 T}{T+237.3}\\right)\\right]}{(T+237.3)^{2}} \\] \\[u_{2}=u_{z_g} \\frac{4.87}{\\ln (67.8 z_g-5.42)}\\] Bulk surface resistance (\\(r_s\\)). \\[r_{s}=\\frac{r_{l}}{LAI_{\\text { active }}}\\] \\[LAI_{\\text active} = 0.5 LAI\\] Aerodynamic resistance (\\(r_a\\)) \\[r_{a}=\\frac{\\ln \\left[\\frac{Z_{m}-d}{Z_{o m}}\\right] \\ln \\left[\\frac{Z_{h}-d}{Z_{o h}}\\right]}{k^{2} u_{z}}\\] Atmospheric pressure at elevation \\(z\\) is: \\[P=101.3\\left(\\frac{293-0.0065 z}{293}\\right)^{5.26}\\] \\[ \\gamma =\\frac{C_{p} P}{\\varepsilon \\lambda}=0.665 \\times 10^{-3} P \\] \\[RH=100 \\frac{{e}_{a}}{e}^{\\circ(T)}\\] \\[ e^{\\circ}(T)=0.6108 \\operatorname{exp}\\left[ \\frac{17.27 T}{{T}+237.3}\\right] \\] Where \\(R_n\\) is the net radiation [\\(J/m^2\\)] \\(G\\) is the soil heat flux [\\(J/m2\\)], \\((e_s - e_a)\\) represents the vapour pressure deficit of the air [\\(J/m2\\)], \\(\\rho_a\\) is the mean air density at constant pressure [\\(kg/m^2\\)] \\(D\\) represents the slope of the saturation vapour pressure temperature relationship [\\(J/m2\\)], \\(r_s\\) and \\(r_a\\) are the (bulk) surface and aerodynamic resistances [\\(s/m\\)], \\(LAI\\) and \\(LAI_{\\text active}\\) is the Leaf Area Index (LAI) and active LAI [\\(m^2/m^2\\)]. \\(r_l\\) bulk stomatal resistance of the well-illuminated leaf [\\(s/m\\)], \\(P\\) atmospheric pressure [\\(kPa\\)], \\(z\\) elevation above sea level [\\(m\\)] \\(\\gamma\\) psychrometric constant [\\(kPa/C\\)], \\(l\\) latent heat of vaporization, 2.45 [\\(MJ kg-1\\)], \\(c_p\\) specific heat at constant pressure, 1.013*10-3 [\\(MJ/kg/°C\\)], \\(\\varepsilon\\) ratio molecular weight of water vapour/dry air = \\(0.622\\). \\(e°(T)\\) saturation vapour pressure at the air temperature \\(T\\) [\\(kPa\\)], \\(T\\) air temperature [\\(°C\\)], \\(u_2\\) wind speed at 2 m above ground surface [\\(m/s\\)], \\(u_{z_g}\\) measured wind speed at \\(z_g\\) \\(m\\) above ground surface [\\(m/s\\)], \\(z_g\\) height of measurement above ground surface [\\(m\\)]. "],
["surf.html", "Chapter 3 Landsurface 3.1 Infiltration 3.2 Overland flow", " Chapter 3 Landsurface Water balance on landsurface of each element. \\[ \\frac {dS_{sf}}{dt} = P_{net} - E_{ic} - q_{inf} - q_{sf} \\] where \\(S\\) Ground water storage [ \\(m\\) ] \\(q_r\\) Recharge to ground water [ \\(m/T\\) ] \\(q_{sf}\\) Horizontal ground water flow at three directions [ \\(m^3/T\\) ] \\[q_{sf} = \\sum_{j=1}^3 {Q_{j} } / {A}\\] \\(Q_{j}\\) Horizontal ground water flow at three directions [ \\(m^3/T\\) ] \\(A\\) Area of the element, [ \\(m^2\\) ]. 3.1 Infiltration Green-Ampt equations. \\[q_{inf} = K_{eff} * \\Delta \\theta \\frac{y0 + h_{f}}{h_f}\\] library(PIHMgisR) y0=0:100/100 theta=0.5 * (0:10)/10 Ksat = 0.1 #m/day qi=theta * 0 for(i in 1:length(theta)){ for(j in 1:length(y0)){ qi[i]=GreenAmpt(theta[i], thetas = 0.5, ksat = Ksat, Hfront = 0) } } plot(theta, qi, ylab=&#39;Infiltration (m/day)&#39; ) 3.2 Overland flow St. Venant equations Continuity equation \\[ \\frac{\\partial Q}{\\partial x}+\\frac{\\partial A}{\\partial t}=0 \\] Momentum Equation \\[ \\frac{1}{A} \\frac{\\partial Q}{\\partial t}+\\frac{1}{A} \\frac{\\partial}{\\partial x}\\left(\\frac{Q^{2}}{A}\\right)+g \\frac{\\partial y}{\\partial x}-g\\left(S_{o}-S_{f}\\right)=0 \\] Assumptions for St. Venant Equations Flow is one-dimensional Hydrostatic pressure prevails and vertical accelerations are negligible Streamline curvature is small. Bottom slope of the channel is small. Manning’s equation is used to describe resistance effects The fluid is incompressible "],
["unsat.html", "Chapter 4 Unsaturated Zone", " Chapter 4 Unsaturated Zone \\[K(\\psi)=k_{r}(\\psi) K_{s a t}\\] Relative pemeability function: \\[k_{r}\\left(\\Theta_{e}\\right)=\\Theta_{e}^{1 / 2}\\left[1-\\left(1-\\Theta_{e}^{1 / m}\\right)^{m}\\right]^{2}\\] Effective saturation as a function of matrix pressure head (van Genuchten, 1980): \\[\\Theta_{e}(\\psi)=\\frac{\\Theta-\\Theta_{r}}{1-\\Theta_{r}}=\\frac{1}{[1+(|\\alpha \\psi|)^{\\beta}] ^ m} ~~~~~~~~~~ \\psi&lt;0\\] \\[\\Theta_{e}(\\psi)={1} ~~~~~~~~~~ \\psi \\geq 0\\] Relative permeability is a function of effective saturation \\(\\Theta_{e}(\\psi)\\)(Mualem, 1976) \\[k_{r}\\left(\\Theta_{e}\\right)=\\Theta_{e}^{1 / 2}\\left[1-\\left(1-\\Theta_{e}^{1 / m}\\right)^{m}\\right]^{2}\\] Where - \\(\\Theta_{r}\\)= residual soil moisture [dimensionless]; - \\(\\beta\\)= van Genuchten soil parameter, representing the degree of pore-size uniformity (as \\(\\beta\\) increases, uniformity increases) [dimensionless], (\\(m = 1-1/\\beta\\)) and - \\(\\alpha\\)= van Genuchten soil parameter, representing the inverse characteristic length of the soil pores [\\(1/L\\)]. Put a example of the equations, i.e. \\(K_e\\) along \\(\\theta\\) "],
["gw.html", "Chapter 5 Saturated Zone 5.1 Impervious boundary 5.2 Horizontal flow", " Chapter 5 Saturated Zone 5.1 Impervious boundary 5.2 Horizontal flow \\[ \\frac {dS_{gw}}{dt} = q_r + q_{gw}\\] where \\(S\\) Ground water storage [\\(m\\)] \\(q_r\\) Recharge to ground water [\\(m/T\\)] \\(q_{gw}\\) Horizontal ground water flow at three directions [\\(m^3/T\\)] \\[q_{gw} = \\sum_{j=1}^3 Q_{j} / A\\] \\(A\\) Area of the elements \\(i\\), [\\(m^2\\)]. "],
["Riv.html", "Chapter 6 River", " Chapter 6 River River water balance: \\[ \\frac{d S_{riv}}{d t} = Q_{d} + Q_{s} + Q_{g} + Q_{u} \\] Where: \\(S_{riv}\\) - Water storage in River segments [\\(m\\)] \\(Q_{d}\\) - Water flux to downstream [\\(m^3/T\\)] \\(Q_{s}\\) - Surface water flux between river and element [\\(m^/T\\)] \\(Q_{g}\\) - Ground water flux between river and element [\\(m^3/T\\)] \\(Q_{out}\\) - Water flux from upstream(s) [\\(m^3/T\\)] \\[ Q_{d} = \\frac{A_{cs}}{n} * {(\\frac{A_{cs}}{Y})} ^ {\\frac{2}{3}} * \\sqrt[]{S} \\] where: \\(A_{cs}\\) - Average cross section area of river channels (THIS and downstream channel) [\\(m^2\\)] \\(n\\) - Manning’s roughness [\\(T m^{-\\frac{1}{3}}\\)] \\(Y\\) - Mean water level in river channels [\\(m\\)] \\(S\\) - Slope of river bed [\\(m/L\\)] \\[ Q_s = \\frac{2}{3} C_{wr} L \\sqrt[]{2g} {dH}^ \\frac{3}{2} \\] where: $C_{wr} $ - Weir Discharge Coefficient [\\(1\\)] \\(L\\) - Length of weir [\\(m\\)] "],
["lake.html", "Chapter 7 Lake", " Chapter 7 Lake Water balance of lake: \\[ \\frac{d S_{lake}}{d t} = P - E + ( q_{sf} + q_{gw} + q_{riv}) \\] where \\(S_{lake}\\) Lake water storage [\\(m\\)] \\(P\\) Precipitation [\\(m/T\\)] \\(E\\) Evaporation from lake [\\(m/T\\)] \\(q_{sf}\\) Water flow from landsurface to lake, [\\(m/T\\)] \\[q_{sf} = \\sum_{j=1}^{Nele} Q_{j}^{sf} / A_{lake}\\] \\(q_{gw}\\) Water flow from ground water to lake, [\\(m/T\\)] \\[q_{gw} = \\sum_{j=1}^{Nele} Q_{j}^{gw} / A_{lake}\\] \\(q_{riv}\\) Water PIHM++.pngflow from rivers to lake, [\\(m/T\\)] \\[q_{riv} = \\sum_{j=1}^{Nriv} Q_{j}^{riv} / A_{lake}\\] \\(Nele\\) and \\(Nriv\\) are number of elements and river adjecent to the lake respectively. [\\(-\\)] \\(A_i\\) Area of the elements \\(i\\), [\\(m^2\\)]. "],
["calibration.html", "Chapter 8 Calibration", " Chapter 8 Calibration The Covriance Matrix Adaptation Evolution Strategy (CMA-ES). "],
["acknowledge.html", "Acknowledge", " Acknowledge The PIHM Modeling System was initially developed under research grants to The Pennsylvania State University (Penn State) from NSF (EAR 9876800, 1999-2007; EAR 03-10122, 2003-2007), NOAA (NA040AR4310085, 2003-2007), NASA (NAG5-12611, 2002-2005), with continuing grants from NSF and EPA for community model development. The PIHM model is a continuation of 17 years of modeling in hydrology and related fields. In addition to the Pennsylvania State University and Dr. Christopher Duffy, several guaduate student in Dr. Duffy group contributed to the model. We also want to thank all the users in past 17 years who contributed lots of hydrology-related researches that make PIHM community booming. Many thanks to contributors in PIHM family: Name Major Contriution Christopher Duffy Leader of the PIHM group Lele Shu PIHM++ PIHMgisR PIHM analysis tools LUC-PIHM (Land Use Change) Yuning Shi Flux-PIHM MM-PIHM Yu Zhang LE-PIHM (Landscape Evolution) Lake-PIHM Chen Bao RT-PIHM (Reaction transport) Xuan Yu PIHM v2.2 BioBGC-PIHM Gopal Bhatt PIHM v2.0; PIHMgis v3.0 Mukesh Kumar PIHM v2.0 Shuangcai Li PIHM-Sed (Sediment transport) Yizhong Qu PIHM v1.0 — The first version of PIHM "],
["license.html", "License", " License PIHM++ is open source software and the development is coordinated via the PIHM GitHub page (GitHub Page ). Penn State University makes no proprietary claims, either statutory or otherwise, to this version and release of PIHM and considers PIHM to be in the public domain for use by any person or entity for any purpose without any fee or charge. We request that any PIHM user include a credit to Penn State in any publications that result from the use of PIHM. Penn State University makes no proprietary claims, either statutory or otherwise, to this version and release of PIHM and considers PIHM to be in the public domain for use by any person or entity for any purpose without any fee or charge. We request that any PIHM user include a credit to Penn State in any publications that result from the use of PIHM. The names Penn State shall not be used or referenced in any advertising or publicity which endorses or promotes any products or commercial entity associated with or using PIHM, or any derivative works thereof, without the written authorization o Penn State. PIHM is provided on an “AS IS” basis and any warranties, either express or implied, including but not limited to implied warranties of noninfringement, originality, merchantability and fitness for a particular purpose, are disclaimed. Penn State will not be obligated to provide the user with any support, consulting, training or assistance of any kind with regard to the use, operation and performance of PIHM nor to provide the user with any updates, revisions, new versions, error corrections or “bug” fixes. In no event will Penn State be liable for any damages, whatsoever, whether direct, indirect, consequential or special, which may result from an action in contract, negligence or other claim that arises out of or in connection with the access, use or performance of PIHM, including infringement actions. "]
]
